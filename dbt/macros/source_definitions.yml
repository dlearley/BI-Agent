version: 2

sources:
  - name: raw
    database: analytics_db
    schema: public
    tables:
      - name: applications
        description: Raw application data from the main application database
        columns:
          - name: id
            description: Primary key for applications
            tests:
              - unique
              - not_null
          - name: facility_id
            description: Foreign key to facilities table
          - name: candidate_id
            description: Foreign key to candidates table
          - name: status
            description: Current status of the application
          - name: created_at
            description: Timestamp when application was created
          - name: updated_at
            description: Timestamp when application was last updated
          - name: hired_at
            description: Timestamp when candidate was hired
          - name: compliance_score
            description: Compliance score (0-100)
          - name: has_violations
            description: Boolean flag indicating compliance violations

      - name: invoices
        description: Raw invoice data from the billing system
        columns:
          - name: id
            description: Primary key for invoices
            tests:
              - unique
              - not_null
          - name: facility_id
            description: Foreign key to facilities table
          - name: application_id
            description: Foreign key to applications table
          - name: amount
            description: Invoice amount
          - name: status
            description: Invoice status (paid, pending, cancelled)
          - name: created_at
            description: Timestamp when invoice was created
          - name: updated_at
            description: Timestamp when invoice was last updated
          - name: paid_at
            description: Timestamp when invoice was paid

      - name: outreach
        description: Raw outreach data from the recruitment system
        columns:
          - name: id
            description: Primary key for outreach records
            tests:
              - unique
              - not_null
          - name: facility_id
            description: Foreign key to facilities table
          - name: candidate_id
            description: Foreign key to candidates table
          - name: channel
            description: Outreach channel (email, phone, social, etc.)
          - name: message
            description: Outreach message content
          - name: sent_at
            description: Timestamp when outreach was sent
          - name: response_received
            description: Boolean flag indicating if response was received
          - name: responded_at
            description: Timestamp when response was received
          - name: converted
            description: Boolean flag indicating if outreach led to conversion
          - name: created_at
            description: Timestamp when record was created
          - name: updated_at
            description: Timestamp when record was last updated

      - name: facilities
        description: Raw facility data
        columns:
          - name: id
            description: Primary key for facilities
            tests:
              - unique
              - not_null
          - name: name
            description: Facility name
          - name: type
            description: Facility type
          - name: location
            description: Facility location
          - name: created_at
            description: Timestamp when facility was created
          - name: updated_at
            description: Timestamp when facility was last updated

      - name: leads
        description: CRM leads data for sales pipeline
        columns:
          - name: id
            description: Primary key for leads
            tests:
              - unique
              - not_null
          - name: facility_id
            description: Foreign key to facilities table
          - name: rep_id
            description: Sales representative assigned to lead
          - name: status
            description: Lead status in pipeline (new, qualified, contacted, etc.)
          - name: stage
            description: Pipeline stage (lead, sql, opportunity, won, lost)
          - name: created_at
            description: Timestamp when lead was created
          - name: updated_at
            description: Timestamp when lead was last updated
          - name: qualified_at
            description: Timestamp when lead was qualified
          - name: closed_at
            description: Timestamp when lead was closed
          - name: amount
            description: Deal value
          - name: created_month
            description: Cohort month for retention analysis

      - name: opportunities
        description: CRM opportunities from qualified leads
        columns:
          - name: id
            description: Primary key for opportunities
            tests:
              - unique
              - not_null
          - name: lead_id
            description: Foreign key to leads table
          - name: rep_id
            description: Sales representative assigned
          - name: status
            description: Opportunity status
          - name: created_at
            description: Timestamp when opportunity was created
          - name: updated_at
            description: Timestamp when opportunity was last updated
          - name: closed_at
            description: Timestamp when opportunity was closed
          - name: amount
            description: Opportunity value

      - name: tickets
        description: Support tickets for SLA tracking
        columns:
          - name: id
            description: Primary key for tickets
            tests:
              - unique
              - not_null
          - name: facility_id
            description: Foreign key to facilities table
          - name: priority
            description: Ticket priority (low, medium, high, critical)
          - name: status
            description: Ticket status
          - name: created_at
            description: Timestamp when ticket was created
          - name: resolved_at
            description: Timestamp when ticket was resolved
          - name: first_response_at
            description: Timestamp of first response
          - name: sla_met
            description: Boolean flag if ticket met SLA

      - name: satisfaction
        description: Customer satisfaction and NPS survey data
        columns:
          - name: id
            description: Primary key for satisfaction records
            tests:
              - unique
              - not_null
          - name: facility_id
            description: Foreign key to facilities table
          - name: survey_type
            description: Survey type (csat, nps)
          - name: score
            description: Survey score
          - name: created_at
            description: Timestamp when survey was submitted
          - name: feedback
            description: Optional feedback text